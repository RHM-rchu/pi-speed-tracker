


${form}

  <div class="graph_container">
    <canvas id="speed"></canvas>
  </div>
  <div class="change_graph">

  Chart Type:
  <select id="type1">
      <option value="bar">Bar</option>
      <option value="line">Line</option>
      <option value="bubble">bubble</option>
  </select>
  <button id="update1">update</button>
  </div>

  <script>
var ctx = document.getElementById("speed");

Chart.pluginService.register({
    afterDraw: function(chart) {
        if (typeof chart.config.options.lineAt != 'undefined') {
          var lineAt = chart.config.options.lineAt;
            var ctxPlugin = chart.chart.ctx;
            var xAxe = chart.scales[chart.config.options.scales.xAxes[0].id];
            var yAxe = chart.scales[chart.config.options.scales.yAxes[0].id];
            
            // I'm not good at maths
            // So I couldn't find a way to make it work ...
            // ... without having the `min` property set to 0
            if(yAxe.min != 0) return;
            
            ctxPlugin.strokeStyle = "red";
            ctxPlugin.beginPath();
            lineAt = (lineAt - yAxe.min) * (100 / yAxe.max);
            lineAt = (100 - lineAt) / 100 * (yAxe.height) + yAxe.top;
            ctxPlugin.moveTo(xAxe.left, lineAt);
            ctxPlugin.lineTo(xAxe.right, lineAt);
            ctxPlugin.stroke();
        }
    }
});

var chart1 = new Chart(ctx, {
    type: 'bar',//horizontalBar
    data: {
        labels: [
% for a in percent_sp_list:
          "${a}",
% endfor
        ],
        datasets: [{
            label: '${speed_limit} mph - Speed ranges',
            data: [
% for a in percent_sp_list:
              ${percent_sp_list[a]['count']},
% endfor

            ],
            backgroundColor: [
                'rgba(75, 192, 192, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(75, 192, 192, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(255,99,132,1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
});

  document.getElementById('update1').addEventListener('click', function() {
      var type = document.getElementById('type1').value;
      for (const [key, theLineGraph] of Object.entries(chart1.config.data.datasets)) {
        console.log(key, theLineGraph);
        theLineGraph.type = type;
        theLineGraph.fill = true;
        theLineGraph.borderWidth = 2
      }
      chart1.update();
  });
</script>




  <div class="graph_container">
    <canvas id="canvasSpeedGroups"></canvas>
  </div>

  <div class="change_graph">
  Chart Type:
  <select id="type2">
      <option value="line">Line</option>
      <option value="bar">Bar</option>
      <option value="bubble">bubble</option>
  </select>
  <button id="update2">update</button>
  </div>

  <script>
    var config = {
      type: 'line',
      data: {
        labels: [
% for i in range(24): 
          '${i+1}',
% endfor 
        ],
        datasets: [
% for name in graph_hrly_datas:
        {
          label: '${name}',
          backgroundColor: 'rgba(${graph_hrly_datas[name]['rgb']}, 0.2)',
          borderColor: 'rgba(${graph_hrly_datas[name]['rgb']}, 1)',
          data: ${graph_hrly_datas[name]['data']},
          fill: true,
        },
% endfor
        ]
      },
      options: {
        responsive: true,
        scales: {
          xAxes: [{
            scaleLabel: {
              display: true,
              labelString: 'The Hour'
            }
          }]
        },
        title: {
          display: true,
          text: 'Speed Limit ${speed_limit}mph by hour'
        }
      }
    };


    var ctx = document.getElementById('canvasSpeedGroups').getContext('2d');
    var chart2 = new Chart(ctx, config);

    document.getElementById('update2').addEventListener('click', function() {
        var type = document.getElementById('type2').value;
        for (const [key, theLineGraph] of Object.entries(chart2.config.data.datasets)) {
          console.log(key, theLineGraph);
          // chart2s[key] = theLineGraph
          theLineGraph.type = type;
          theLineGraph.fill = true;
          theLineGraph.borderWidth = 2
        }
        chart2.update();
    });
  </script>


<br>
<br>
<table class="paleBlueRows list" >
<thead>
    <tr>
        <th colspan="3">Speed limit ${speed_limit}mph</th>
    </tr>
</thead>
<thead>
    <tr>
        <th>Name</th>
        <th>Total </th>
        <th>Percent</th>
    </tr>
</thead>
% for a in percent_sp_list:
  ${makerow(percent_sp_list[a], a)}
% endfor
<%def name="makerow(rows, name)">
    <tr>
        <td>${name}</td>
        <td>${rows['count']}</td>
        <td>${rows['percent']}%</td>
    </tr>
</%def>
<tfooter>
    <tr>
        <th colspan="3">Total ${total_sp}</th>
    </tr>
</tfooter>
</table>




